<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ちんちろ役表 - API Documentation Included</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: transparent;
            margin: 0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }

        /* メインパネル */
        .rank-panel {
            width: 340px;
            height: 90vh;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(20px);
            border: 2px solid #334155;
            border-left: none;
            border-radius: 0 20px 20px 0;
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5);
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            z-index: 100;
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
        }

        .rank-panel.open {
            transform: translateX(0);
        }

        .panel-header-title {
            font-size: 36px;
            font-weight: 900;
            color: #fbbf24;
            font-style: italic;
            letter-spacing: 0.1em;
            line-height: 1.1;
        }

        .dice-type-display {
            font-size: 18px;
            font-weight: 700;
            color: #f8fafc;
            margin-top: 4px;
            padding-left: 2px;
        }

        /* サイドタブ */
        .side-tab {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: #fbbf24;
            color: #1e293b;
            padding: 25px 12px;
            border-radius: 0 15px 15px 0;
            font-weight: 900;
            cursor: pointer;
            writing-mode: vertical-rl;
            text-orientation: upright;
            letter-spacing: 0.2em;
            box-shadow: 4px 0 15px rgba(251, 191, 36, 0.4);
            z-index: 200;
            transition: all 0.3s;
            font-size: 14px;
            border: 2px solid #1e293b;
            border-left: none;
        }

        /* セクション見出し */
        .section-label {
            font-size: 11px;
            font-weight: 900;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            margin: 15px 0 8px 0;
            padding-bottom: 4px;
            border-bottom: 2px solid rgba(148, 163, 184, 0.2);
            display: flex;
            justify-content: center;
        }

        /* 役の行 */
        .rank-item {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            gap: 15px;
        }

        .dice-container {
            display: flex;
            gap: 4px;
            width: 85px;
            justify-content: center;
        }

        .mini-die {
            width: 24px; height: 24px; background: #ffffff; color: #1e293b;
            border-radius: 4px; font-size: 14px; display: flex;
            align-items: center; justify-content: center; font-weight: 900;
            box-shadow: 0 2px 0 #cbd5e1;
        }
        .mini-die.red { color: #ef4444; }
        .mini-die.dim { opacity: 0.3; background: #64748b; box-shadow: none; }
        .mini-die.target { background: #fbbf24; color: #000; box-shadow: 0 0 8px rgba(251, 191, 36, 0.6); }

        .rank-info { display: flex; align-items: center; justify-content: space-between; width: 140px; }
        .rank-name { font-weight: 700; font-size: 14px; color: #f8fafc; }
        .rank-mult { font-weight: 900; color: #fbbf24; font-size: 15px; }
        .rank-mult.negative { color: #ef4444; }

        #overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0, 0, 0, 0.5); opacity: 0; pointer-events: none;
            transition: opacity 0.3s; z-index: 50;
        }
        #overlay.active { opacity: 1; pointer-events: auto; }

        .rank-list-container { flex-grow: 1; overflow-y: auto; padding-right: 5px; }
        .rank-list-container::-webkit-scrollbar { width: 4px; }
        .rank-list-container::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="overlay" onclick="togglePanel()"></div>

    <div class="side-tab" id="side-tab" onclick="togglePanel()">
        役表を表示
    </div>

    <div id="rank-panel" class="rank-panel">
        <div class="mb-4">
            <div class="flex justify-between items-start">
                <h2 class="panel-header-title">役表</h2>
                <button onclick="togglePanel()" class="text-slate-400 text-3xl font-light hover:text-white leading-none">×</button>
            </div>
            <div id="dice-type-label" class="dice-type-display">通常賽</div>
        </div>
        
        <div id="rank-list" class="rank-list-container">
            <!-- JavaScriptで生成 -->
        </div>

        <div class="mt-4 p-3 bg-slate-900/50 rounded-xl border border-slate-800">
            <p id="info-text" class="text-[10px] text-slate-400 leading-relaxed text-center"></p>
        </div>
    </div>

    <script>
        /**
         * ==========================================
         * RankSystem 関数説明
         * ==========================================
         * 1. clear(): 
         * 表示中の役リストをすべて削除します。新しく表を作り直す際に使用。
         * * 2. addSection(label): 
         * 「通常」や「役物」といった区切り線（見出し）を追加します。
         * - label: 表示する文字列
         * * 3. addRank(name, mult, dice, targetIndex, isSpecial):
         * 役の行を追加します。
         * - name: 役の名前（例: "シゴロ"）
         * - mult: 倍率（数値。プラスなら黄色、マイナスなら赤色で表示）
         * - dice: ダイスの目の配列（[1, 2, 3]など）
         * - targetIndex: 強調表示（黄色）したいダイスのインデックス(0~2)。なければ-1。
         * - isSpecial: trueにするとダイスが「? ? ?」になります。
         * * 4. setDiceName(name):
         * ヘッダー下の「通常賽」などの名前を変更します。
         * * 5. setInfoText(html):
         * 最下部の注釈エリアの内容を変更します。HTMLタグ使用可。
         * * 6. render():
         * 上記の設定を反映して画面上のHTMLを再構築します。
         * ==========================================
         */

        const RankSystem = {
            currentDiceName: "通常賽",
            infoMessage: `<span class="text-yellow-500 font-bold">●</span> 黄色がその役の「目」です。`,
            ranks: [],

            clear() {
                this.ranks = [];
            },

            addSection(label) {
                this.ranks.push({ type: 'label', text: label });
            },

            addRank(name, mult, dice, targetIndex = -1, isSpecial = false) {
                this.ranks.push({
                    type: 'rank',
                    name: name,
                    mult: mult,
                    dice: dice,
                    t: targetIndex,
                    isSpecial: isSpecial
                });
            },

            setDiceName(name) {
                this.currentDiceName = name;
                const el = document.getElementById('dice-type-label');
                if(el) el.innerText = name;
            },

            setInfoText(html) {
                this.infoMessage = html;
                const el = document.getElementById('info-text');
                if(el) el.innerHTML = html;
            },

            render() {
                const list = document.getElementById('rank-list');
                if (!list) return;

                list.innerHTML = this.ranks.map(r => {
                    if (r.type === 'label') {
                        return `<div class="section-label"><span>${r.text}</span></div>`;
                    }
                    
                    let dHtml;
                    if (r.isSpecial) {
                        dHtml = `<div class="mini-die dim">?</div><div class="mini-die dim">?</div><div class="mini-die dim">?</div>`;
                    } else {
                        dHtml = r.dice.map((d, i) => {
                            const isRed = (d === 1 && r.t !== i);
                            const isTarget = (r.t === i);
                            return `<div class="mini-die ${isTarget ? 'target' : ''} ${isRed ? 'red' : ''}">${d}</div>`;
                        }).join('');
                    }
                    
                    const multDisplay = r.mult > 0 ? `x${r.mult}` : `x${r.mult}`;
                    const multClass = r.mult < 0 ? 'negative' : '';
                    
                    return `<div class="rank-item">
                        <div class="dice-container">${dHtml}</div>
                        <div class="rank-info">
                            <div class="rank-name">${r.name}</div>
                            <div class="rank-mult ${multClass}">${multDisplay}</div>
                        </div>
                    </div>`;
                }).join('');

                this.setDiceName(this.currentDiceName);
                this.setInfoText(this.infoMessage);
            }
        };

        /**
         * 初期データセット
         */
        function setupDefaultRanks() {
            RankSystem.clear();
            RankSystem.addSection("役物");
            RankSystem.addRank("ピンゾロ", 5, [1,1,1]);
            RankSystem.addRank("アラシ", 3, [6,6,6]);
            RankSystem.addRank("シゴロ", 2, [4,5,6]);

            RankSystem.addSection("通常");
            RankSystem.addRank("六の目", 1, [2,2,6], 2);
            RankSystem.addRank("五の目", 1, [4,4,5], 2);
            RankSystem.addRank("四の目", 1, [3,3,4], 2);
            RankSystem.addRank("三の目", 1, [1,1,3], 2);
            RankSystem.addRank("二の目", 1, [5,5,2], 2);
            RankSystem.addRank("一の目", 1, [6,6,1], 2);

            RankSystem.addSection("凶役・特殊");
            RankSystem.addRank("ヒフミ", -2, [1,2,3]);
            RankSystem.addRank("目なし", -1, [2,3,5]);
            RankSystem.addRank("ションベン", -1, [0,0,0], -1, true);

            RankSystem.render();
        }

        function togglePanel() {
            const panel = document.getElementById('rank-panel');
            const overlay = document.getElementById('overlay');
            const tab = document.getElementById('side-tab');
            const isOpen = panel.classList.toggle('open');
            overlay.classList.toggle('active');
            tab.style.opacity = isOpen ? "0" : "1";
            tab.style.pointerEvents = isOpen ? "none" : "auto";
        }

        window.onload = setupDefaultRanks;
    </script>
</body>
</html>