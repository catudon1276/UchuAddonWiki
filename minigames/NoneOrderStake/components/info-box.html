<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enemy Info Box Component</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            /* ユーザーのデフォルト色：深い紺色 */
            --default-card-color-1: #1e3a8a;
            --default-card-color-2: #1e1b4b;
            --active-glow-color: rgba(251, 191, 36, 0.6);
        }

        .enemy-box {
            width: 240px;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 10px;
            padding: 12px;
            color: white;
            font-family: sans-serif;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        /* アクティブ（自分のターン）時のスタイル */
        .enemy-box.is-active {
            border-color: #fbbf24;
            box-shadow: 0 0 20px var(--active-glow-color), 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            animation: active-pulse 2s infinite ease-in-out;
        }

        @keyframes active-pulse {
            0% { box-shadow: 0 0 8px var(--active-glow-color), 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
            50% { box-shadow: 0 0 25px rgba(251, 191, 36, 0.9), 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
            100% { box-shadow: 0 0 8px var(--active-glow-color), 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
        }

        .enemy-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .enemy-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #475569;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            flex-shrink: 0;
            border: 1px solid #64748b;
        }

        .enemy-avatar img {
            width: 80%;
            height: 80%;
            object-fit: cover;
            filter: brightness(0) invert(1);
        }

        .enemy-name {
            font-weight: 800;
            font-size: 13px;
            color: #f8fafc;
        }

        .info-row {
            display: flex;
            gap: 4px;
            margin-bottom: 10px;
        }

        .info-item {
            flex: 1;
            background: #0f172a;
            padding: 4px 2px;
            border-radius: 4px;
            text-align: center;
            transition: background-color 0.3s;
        }

        .flash-update { background-color: #334155 !important; }

        .label {
            font-size: 8px;
            color: #64748b;
            display: block;
            margin-bottom: 1px;
        }

        .value {
            font-size: 11px;
            font-weight: bold;
            color: #fbbf24;
        }

        .dice-row {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 12px;
        }

        .dice-slot {
            width: 28px;
            height: 28px;
            background: #f8fafc;
            color: #1e293b;
            border-radius: 3px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            font-weight: 900;
            box-shadow: inset 0 -2px 0 rgba(0,0,0,0.1);
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card-row {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 4px;
            border-top: 1px solid #334155;
            min-height: 60px;
            position: relative;
            overflow: visible;
        }

        .card-back-mini {
            width: 30px;
            height: 42px;
            background: linear-gradient(135deg, var(--this-color-1, var(--default-card-color-1)) 0%, var(--this-color-2, var(--default-card-color-2)) 100%);
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 3px;
            flex-shrink: 0;
            position: relative;
            box-shadow: -2px 0 5px rgba(0,0,0,0.4);
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .card-enter {
            opacity: 0;
            transform: scale(0.5);
        }

        .card-exit {
            z-index: 100 !important;
            transform: translateY(-20px) scale(0.8) !important;
            opacity: 0 !important;
            position: absolute !important;
        }
    </style>
</head>
<body class="bg-gray-900 p-8 flex flex-col items-center">

    <div id="enemy-box" class="enemy-box">
        <div class="enemy-header">
            <div class="enemy-avatar">
                <img src="https://img.icons8.com/material-rounded/96/user.png" alt="ユーザー" onerror="this.style.display='none'">
            </div>
            <div id="enemy-name" class="enemy-name">ユーザー</div>
        </div>

        <div class="info-row">
            <div id="money-box" class="info-item">
                <span class="label">所持金</span>
                <div id="money-val" class="value">¥12,800</div>
            </div>
            <div id="bet-box" class="info-item">
                <span class="label">掛け金</span>
                <div id="bet-val" class="value">¥2,000</div>
            </div>
        </div>

        <div class="dice-row">
            <div id="dice-0" class="dice-slot">1</div>
            <div id="dice-1" class="dice-slot">1</div>
            <div id="dice-2" class="dice-slot">1</div>
        </div>

        <div id="card-row" class="card-row">
            <!-- JavaScriptでカードが生成されます -->
        </div>
    </div>

    <!-- プレビュー用デバッグボタン（後で削除してOK） -->
    <div class="mt-8 flex gap-4">
        <button onclick="setTurnActive(true)" class="px-4 py-2 bg-yellow-600 text-white rounded text-xs">ターン開始</button>
        <button onclick="setTurnActive(false)" class="px-4 py-2 bg-gray-700 text-white rounded text-xs">ターン終了</button>
    </div>

    <script>
        /**
         * 自分のターンの時にボックスを光らせる
         * @param {boolean} isActive - trueで光る、falseで消える
         */
        function setTurnActive(isActive) {
            const box = document.getElementById('enemy-box');
            if (isActive) {
                box.classList.add('is-active');
            } else {
                box.classList.remove('is-active');
            }
        }

        /**
         * カード全体のデフォルト色（ユーザーイメージ）を変更する
         */
        function setDefaultCardColor(color1, color2) {
            document.documentElement.style.setProperty('--default-card-color-1', color1);
            document.documentElement.style.setProperty('--default-card-color-2', color2);
        }

        /**
         * 個別のカードに色をセットする
         */
        function setIndividualCardColor(element, color1, color2) {
            if (!element) return;
            element.style.setProperty('--this-color-1', color1);
            element.style.setProperty('--this-color-2', color2);
        }

        function _animateUpdate(boxId, valId, newVal) {
            const box = document.getElementById(boxId);
            const val = document.getElementById(valId);
            val.innerText = `¥${newVal.toLocaleString()}`;
            box.classList.add('flash-update');
            setTimeout(() => box.classList.remove('flash-update'), 300);
        }

        function updateMoney(amount) { _animateUpdate('money-box', 'money-val', amount); }
        function updateBet(amount) { _animateUpdate('bet-box', 'bet-val', amount); }

        function setDice(nums) {
            nums.forEach((n, i) => {
                const slot = document.getElementById(`dice-${i}`);
                slot.style.transform = 'scale(1.3) rotate(10deg)';
                slot.innerText = n;
                setTimeout(() => slot.style.transform = 'scale(1) rotate(0deg)', 250);
            });
        }

        function updateCardLayout() {
            const row = document.getElementById('card-row');
            const cards = Array.from(row.querySelectorAll('.card-back-mini:not(.card-exit)'));
            const count = cards.length;
            if (count === 0) return;

            const containerWidth = 210;
            const cardWidth = 30;
            
            let negativeMargin = -10; 
            if (count * (cardWidth + negativeMargin) > containerWidth) {
                negativeMargin = (containerWidth - cardWidth) / (count - 1) - cardWidth;
            }

            cards.forEach((card, i) => {
                card.style.marginLeft = i === 0 ? '0px' : `${negativeMargin}px`;
                card.style.zIndex = i;
            });
        }

        function addCard(c1, c2) {
            const row = document.getElementById('card-row');
            const card = document.createElement('div');
            card.className = 'card-back-mini card-enter';
            
            if (c1 && c2) {
                setIndividualCardColor(card, c1, c2);
            }

            row.appendChild(card);
            card.offsetHeight;
            updateCardLayout();
            setTimeout(() => card.classList.remove('card-enter'), 400);
        }

        function removeCard() {
            const row = document.getElementById('card-row');
            const activeCards = row.querySelectorAll('.card-back-mini:not(.card-exit)');
            if (activeCards.length > 0) {
                const target = activeCards[activeCards.length - 1];
                target.classList.add('card-exit');
                updateCardLayout();
                setTimeout(() => {
                    if (target.parentNode === row) row.removeChild(target);
                }, 400);
            }
        }

        window.onload = () => {
            setDice([1, 1, 1]);
            for(let i=0; i<3; i++) {
                setTimeout(addCard, i * 150);
            }
        };
    </script>
</body>
</html>