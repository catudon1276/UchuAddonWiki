<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Progate Clone - Dino Game</title>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" xintegrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="stylesheet.css">
</head>
<body>
  <header>
    <div class="container">
      <div class="header-left">
        <img class="logo" src="https://prog-8.com/images/html/advanced/main_logo.png">
      </div>
      <span class="fa fa-bars menu-icon"></span>
      <div class="header-right">
        <a href="#">レッスン</a>
        <a href="#">新規登録</a>
        <a href="#" class="login">ログイン</a>
      </div>
    </div>
  </header>

  <div class="top-wrapper">
    <div class="container">
      <h1>LEARN TO CODE.<br>LEARN TO BE CREATIVE.</h1>
      <p>Progateはオンラインプログラミング学習サービスです。</p>
      <div class="btn-wrapper">
        <a href="#game-section" class="btn signup">新規登録はこちら</a>
      </div>
    </div>
  </div>

  <div class="lesson-wrapper">
    <div class="container">
      <div class="heading">
        <h2>Learn Where to Get Started!</h2>
      </div>
      <div class="lessons">
        <div class="lesson">
          <div class="lesson-icon">
            <img src="https://prog-8.com/images/html/advanced/html.png">
            <p>HTML & CSS</p>
          </div>
          <p class="text-contents">ウェブページの作成に使用される言語です。</p>
        </div>
      </div>
      <div class="clear"></div>
    </div>
  </div>

  <!-- ゲームセクション -->
  <div id="game-section" class="game-wrapper">
    <div class="container">
      <div class="heading">
        <h2>Uchu Dino Run</h2>
        <h3>Space / 左クリック / タップでジャンプ！</h3>
      </div>
      <div class="canvas-container">
        <canvas id="gameCanvas" width="800" height="200"></canvas>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <img src="https://prog-8.com/images/html/advanced/footer_logo.png">
      <p>Learn to Code, Learn to be Creative.</p>
    </div>
  </footer>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // 画像設定
    const dinoImg = new Image();
    dinoImg.src = "Resource/Hjk.png";

    let score = 0;
    let gameSpeed = 5;
    let isGameOver = false;
    let animationId;

    const dino = {
      x: 50,
      y: 160,
      width: 50,
      height: 50,
      dy: 0,
      jumpForce: 13,
      gravity: 0.6,
      grounded: false,
      draw() {
        if (dinoImg.complete && dinoImg.naturalHeight !== 0) {
          ctx.drawImage(dinoImg, this.x, this.y, this.width, this.height);
        } else {
          ctx.fillStyle = "#5dca88"; 
          ctx.fillRect(this.x, this.y, this.width, this.height);
        }
      }
    };

    let obstacles = [];
    function spawnObstacle() {
      let h = 30 + Math.random() * 40;
      obstacles.push({ x: canvas.width, y: canvas.height - h, w: 20, h: h });
    }

    function jump() {
      if (isGameOver) {
        resetGame();
        return;
      }
      if (dino.grounded) {
        dino.dy = -dino.jumpForce;
        dino.grounded = false;
      }
    }

    // キーボード
    window.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        if (window.scrollY > 400) e.preventDefault();
        jump();
      }
    });

    // 左クリック対応
    canvas.addEventListener("mousedown", (e) => {
      if (e.button === 0) {
        jump();
      }
    });

    // タッチ
    canvas.addEventListener("touchstart", (e) => {
      e.preventDefault();
      jump();
    }, { passive: false });

    function resetGame() {
      score = 0;
      gameSpeed = 5;
      obstacles = [];
      isGameOver = false;
      dino.y = 160;
      dino.dy = 0;
      update();
    }

    function update() {
      if (isGameOver) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // 地面
      ctx.strokeStyle = "#ddd";
      ctx.beginPath();
      ctx.moveTo(0, 200);
      ctx.lineTo(800, 200);
      ctx.stroke();

      dino.dy += dino.gravity;
      dino.y += dino.dy;

      if (dino.y + dino.height > canvas.height) {
        dino.y = canvas.height - dino.height;
        dino.dy = 0;
        dino.grounded = true;
      }
      dino.draw();

      if (Math.random() < 0.02 && (obstacles.length === 0 || obstacles[obstacles.length - 1].x < canvas.width - 250)) {
        spawnObstacle();
      }

      for (let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.x -= gameSpeed;
        
        ctx.fillStyle = "#ff4d4d"; 
        ctx.fillRect(o.x, o.y, o.w, o.h);

        if (dino.x < o.x + o.w && dino.x + dino.width > o.x && 
            dino.y < o.y + o.h && dino.y + dino.height > o.y) {
          isGameOver = true;
          showGameOver();
        }

        if (o.x + o.w < 0) {
          obstacles.splice(i, 1);
          score++;
          gameSpeed += 0.15; // 内部的なスピードアップ処理は継続
        }
      }

      // スコア表示（スピード表示を削除）
      ctx.fillStyle = "#333";
      ctx.font = "bold 22px Arial";
      ctx.textAlign = "left";
      ctx.fillText("SCORE: " + score, 650, 40);

      animationId = requestAnimationFrame(update);
    }

    function showGameOver() {
      ctx.fillStyle = "rgba(0,0,0,0.8)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#fff";
      ctx.textAlign = "center";
      ctx.font = "bold 40px Arial";
      ctx.fillText("GAME OVER", canvas.width / 2, 90);
      ctx.font = "20px Arial";
      ctx.fillText("Final Score: " + score, canvas.width / 2, 130);
      ctx.font = "16px Arial";
      ctx.fillText("Click or Space to Retry", canvas.width / 2, 165);
    }

    update();
  </script>
</body>
</html>